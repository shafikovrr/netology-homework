# Домашнее задание к занятию "`Резервное копирование баз данных`" - `Шафиков Ринат`

---

### Задание 1

`Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 
Необходимо описать, какие варианты резервного копирования подходят в случаях:`

1. `Необходимо восстанавливать данные в полном объёме за предыдущий день.`
2. `Необходимо восстанавливать данные за час до предполагаемой поломки.`
3. `Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.`

`Приведите ответ в свободной форме.`

### Решение 1

1. `В данном случаен подойдет инкрементное копирование баз данных один раз в сутки + полный бекап базы один раз в неделю, в месяц, в квартал. Так же можно организовать систему репликации  баз данных - (мастер-слейв-кластер)`
2. `В данном случаен подойдет инкрементное копирование баз данных один раз в час + полный бекап базы один раз в неделю, в месяц, в квартал. Так же можно организовать систему репликации  баз данных - (мастер-слейв-кластер)`
3. `В данном случае применяется репликация баз данных, когда вместе работают несколько серверов - один (или несколько) мастер - основной сервер хранения данных и слейв (или несколько) - синхронизированы с мастером. При выходе из строя мастера - слейв начинает исполнять роль мастера.`

---

### Задание 2

`PostgreSQL`

1. `С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).`
2. `Возможно ли автоматизировать этот процесс? Если да, то как?`

`Приведите ответ в свободной форме.`

### Решение 2

1. Синтаксис команды резервного копирования базы данных

```
pg_dump [connection-option...] [option...] [dbname]
```

Пример

```
pg_dump -Fc mydb > db.dump
```
F - необходимо указать формат архива. 
c - пользовательский формат (custom).

```
https://www.postgresql.org/docs/current/app-pgdump.html
```

Синтаксис команды восстановления базы данных

```
pg_restore [connection-option...] [option...] [filename]
```

Пример

```
pg_restore -C -d postgres db.dump
```

-C - создает базу данных перед восстановлением с именем файла дампа
-d - подключение к указанной базе данных "postgres" и восстановление ее из db.dump.
Базой данных, указанной в параметре -d , может быть любая база данных, существующая в кластере; pg_restore использует ее только для выполнения CREATE DATABASE команды для mydb. С помощью -C Данные всегда восстанавливаются в имя базы данных, которое отображается в файле дампа.

```
https://www.postgresql.org/docs/current/app-pgrestore.html
```

2. Запуск бекапа с помощью средств операционной системы через CRON (запуск скрипта) 

```
0 5 * * 0-6 /home/www/pg_backup.bash
```

Или с помощью pg_cron - сторонее программное обеспечение, пзволяющее выполнять резервное копирование внутри базы данных.

---

### Задание 3

`MySQL`

1. `С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.`
2. `В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?`

`Приведите ответ в свободной форме.`

### Решение 3

1. Пример команды инкрементного резервного копирования базы данных MySQL

```
https://dev.mysql.com/doc/mysql-enterprise-backup/8.0/en/mysqlbackup.incremental.html
```

```
mysqlbackup --defaults-file=/home/dbadmin/my.cnf \
  --incremental \
  --backup-dir=/home/dbadmin/temp_dir \
  --backup-image=incremental_image1.bi \
   backup-to-image
```

Параметры инкрементного резервного копирования

```
https://dev.mysql.com/doc/mysql-enterprise-backup/8.0/en/backup-incremental-options.html
```
---
